## 持久化

两种持久化方式

- RDB
- AOF



### RDB持久化

实现方式是什么？

- 快照
- 快照的条件：时间和改动的键的个数



过程是什么：

1. fork子进程（写时复制）
2. 子进程往硬盘写数据
3. 写完替换



RDB文件为啥最后替换？





### AOF

`append only file `只追加文件持久化

开启：`appendonly yes`

方式是什么？

- 输入一条指令追加一条记录到磁盘(进入系统磁盘缓存)
- aof文件中，就是保存的是指令，文本文件





## 复制

所谓的主从复制

主数据库写，从数据库读。（自动同步）



### 原理

sync命令

保存快照和缓存命令发送从数据库

在主数据库关闭持久化，在从数据库开启持久化（如果需要恢复使用slaveof no one)将从数据库提升为主数据库，然后同步回来数据

